# Git / GitHub 使用指南

[TOC]

## 本地库操作命令（命令行）

### 准备工作

- **`git init` 本地库初始化命令**
  该命令会在项目根目录下创建 .git 目录，里面存放了与本地库相关的配置文件

- **`git config` 设置项目级签名**
  项目级签名仅在当前项目内生效
  **`git config --global` 设置系统级签名**
  系统级签名在当前系统用户下生效
  命令 + `user.name ***` 设置用户名
  命令 + `user.email ***` 设置邮箱地址

  > 项目级签名的优先级比系统级签名更高
  > 项目级签名保存在 ./.git/config 文件里
  > 系统级签名保存在 /c/User/用户名/.gitconfig 文件里

- **`git clone <url>` 命令会拷贝一个 git 仓库到本地**

- **`--soft` 后缀表示只对版本库进行操作**
  **`--mixed` 后缀表示对版本库和暂存区进行操作**
  **`--hard` 后缀表示对版本库、暂存区和工作区进行操作修改**

### 暂存区操作

- **`git status` 查看项目的文件状态**
  `-s` 后缀表示简略信息。
  **该命令会显示：**

  1. 从工作区里添加到暂存区的文件（跟踪状态）
  2. 未从工作区里添加到暂存区的文件（未跟踪状态）
  3. 暂存区里未进行更新的文件

- **`git diff <file>` 命令查看工作区和暂存区文件的比较信息**
  **`git diff HEAD <file>` 命令查看本地库和暂存区文件的比较信息**
  diff（different）

- **`git add <file>` 将工作区的文件同步到暂存区**
  **`git add .` 将工作区的所有文件同步到暂存区**
  包括修改和删除也是使用该命令

- **`git reset <file>` 将暂存区的文件同步到工作区**
  **`git reset .` 将暂存区的所有文件同步到工作区**

- **`git rm --cache <file>` 删除暂存区的文件**
  **`git rm --f <file>` 删除暂存区和工作区的文件**
- **`git mv <file>` 命令用于剪切或重命名**

### 版本库操作

- **`git commit <file>` 从暂存区提交到版本库**
  **命令 + `-m "message" <file>` 提交并设置备注**

- **`git reflog` 查看版本库的版本信息**
  **`git log` 查看版本库的版本信息**
  **`git log --pretty=online` 每条信息显示一行**
  **`git log --online` 每条信息显示一行并简写哈希值**

- **`git reset <hash_index>` 修改 HEAD 指针到指定版本**
  **`git reset HEAD` 将版本库同步到暂存区**
  不加后缀默认是 `--mixed` 后缀。
  **`git reset HEAD^^` 回退 HEAD 指针到 `^` 的个数个版本前**
  **`git reset HEAD~2` 回退 HEAD 指针到 `2` 个版本前**
  一般加 `--hard` 后缀
  HEAD 指针指向当前分支

### 分支操作

> 分支用于并行推进多个功能的开发，以提高开发效率
> 分支之间彼此独立

- **`git branch -v` 命令查看项目中所有的分支**
- **`git branch <branch>` 命令创建新的分支**
- **`git branch -r <branch>` 命令删除分支**
- **`git checkout <branch>` 命令切换分支**

- **`git merge <branch>` 命令合并其他分支到当前分支上**
  **合并冲突**
  1. 进行分支合并时，如果需要更新的代码已经被更新过，就会出现合并冲突
  2. 出现合并冲突时，会由自动合并改为手动合并，需要手动修改出现冲突的代码
  3. 修改完成后将文件同步到暂存区，最后执行 `git commit` 命令完成分支合并

## 远程库操作命令（命令行）

- **`git remote add <url_name> <url>` 命令设置推送地址**
  **`git remote -v` 命令查看推送地址**
- **`git push <url> <branch>` 命令向远程库推送**
  在出现合并冲突时就需要先 `pull` 到本地手动进行分支合并再进行推送
- **SSH 免密登陆**
  1. 在用户根目录下 `ssh-keygen -t rsa -C <email>` 生成 SSH 密钥
  2. 在 GitHub 的 SSH and GPG keys 菜单下保存密钥
  3. 最后执行 `git push <ssh_url> <branch>` 就可以完成推送了
- **`git clone <url>` 将远程库克隆到本地库**
  **`clone` 操作会有三个作用：**
  1. 初始化本地库；
  2. 下载远程库；
  3. 创建远程地址别名
- **`git pull <url> <branch>` 命令拉取远程库到本地库**
  `pull` = `fetch` + `merge` 拉取操作可以分解未下载与分支合并
  **`git fetch <url> <branch>` 命令下载远程库到本地库**
  `git checkout <url>/<branch>` 命令查看下载到本地库的项目文件
  `git merge <url>/<branch>` 命令将下载到的分支与本地库进行分支合并
- **跨团队协作开发**
  1. fork 操作拷贝他人项目到自己的远程仓库
  2. pull request 操作申请将自己的远程库合并到他人的远程库中

## Git 工作流

1. 集中式工作流
   以中央仓库作为项目中所有修改的单点实体，无分支
2. gitflow 工作流
   为功能开发、发布准备和维护设立独立分支，使迭代更加流畅
3. forking
   可以接受不受信任贡献者的提交，帮助跨团队协作开发

### gitflow 工作流分支

1. master 主干分支
2. develop 开发分支
3. feature 功能分支
   在开发分支的基础上创建出来的分支，完成后再合并入开发分支
4. hotfix 修复分支
5. release 准生产分支（预发布分支）

## 版本保存机制

- **快照式版本控制**
  Git 把文件看作式小型文件系统的一组快照，每次提交更新时都会对当前的全部文件制作一个快照并保存其索引。如果更新时文件没有修改，则保存之前文件的索引。
- **集中式版本控制**
  以文件变更列表的方式存储信息，将保存的信息看作是一组基本文件和每个文件随时间逐步累积的差异。
- **创建分支时会生成指针指向当前版本**
- **切换分支时 HEAD 指针会在分支之间移动**

### Hash 算法

- **Hash 是一个系列的加密算法**
  Hash 可以根据源数据计算出一个特征码
- **Hash 算法的特点**
  1. 无论源数据量有多大，经过同一个哈希算法计算出的特征码长度都是相同的
  2. 相同的数据经过哈希算法计算后的结果相同
  3. 源数据产生变化后，特征码也会发生变化
  4. 哈希算法不可逆（非对称性加密）
