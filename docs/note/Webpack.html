<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack@4.x | Lost</title>
    <meta name="description" content="Just playing around">
    <link rel="shortcut icon" type="image/x-icon" href="/mynote/favicon.ico">
    
    <link rel="preload" href="/mynote/assets/css/0.styles.238f19cf.css" as="style"><link rel="preload" href="/mynote/assets/js/app.2c9fd942.js" as="script"><link rel="preload" href="/mynote/assets/js/2.6669d9a5.js" as="script"><link rel="preload" href="/mynote/assets/js/50.b864681f.js" as="script"><link rel="prefetch" href="/mynote/assets/js/10.ec38af22.js"><link rel="prefetch" href="/mynote/assets/js/11.6e96399e.js"><link rel="prefetch" href="/mynote/assets/js/12.f5ed9fd5.js"><link rel="prefetch" href="/mynote/assets/js/13.1372c9c7.js"><link rel="prefetch" href="/mynote/assets/js/14.e75aa888.js"><link rel="prefetch" href="/mynote/assets/js/15.43dcc387.js"><link rel="prefetch" href="/mynote/assets/js/16.cb699e90.js"><link rel="prefetch" href="/mynote/assets/js/17.c77796db.js"><link rel="prefetch" href="/mynote/assets/js/18.e20533a8.js"><link rel="prefetch" href="/mynote/assets/js/19.4720274a.js"><link rel="prefetch" href="/mynote/assets/js/20.a9de4d36.js"><link rel="prefetch" href="/mynote/assets/js/21.10e05474.js"><link rel="prefetch" href="/mynote/assets/js/22.2e2ccadc.js"><link rel="prefetch" href="/mynote/assets/js/23.9b47c8f7.js"><link rel="prefetch" href="/mynote/assets/js/24.947a4b54.js"><link rel="prefetch" href="/mynote/assets/js/25.42edce52.js"><link rel="prefetch" href="/mynote/assets/js/26.fdcf488c.js"><link rel="prefetch" href="/mynote/assets/js/27.97a388ef.js"><link rel="prefetch" href="/mynote/assets/js/28.60140474.js"><link rel="prefetch" href="/mynote/assets/js/29.bd6c4f64.js"><link rel="prefetch" href="/mynote/assets/js/3.5bba3714.js"><link rel="prefetch" href="/mynote/assets/js/30.c7449524.js"><link rel="prefetch" href="/mynote/assets/js/31.5750d658.js"><link rel="prefetch" href="/mynote/assets/js/32.6f7f86fa.js"><link rel="prefetch" href="/mynote/assets/js/33.6ea019b4.js"><link rel="prefetch" href="/mynote/assets/js/34.70892a2e.js"><link rel="prefetch" href="/mynote/assets/js/35.02d55ff3.js"><link rel="prefetch" href="/mynote/assets/js/36.943280cb.js"><link rel="prefetch" href="/mynote/assets/js/37.745bdcef.js"><link rel="prefetch" href="/mynote/assets/js/38.44ac57a6.js"><link rel="prefetch" href="/mynote/assets/js/39.27e4df95.js"><link rel="prefetch" href="/mynote/assets/js/4.59116900.js"><link rel="prefetch" href="/mynote/assets/js/40.e4be5e23.js"><link rel="prefetch" href="/mynote/assets/js/41.9103796b.js"><link rel="prefetch" href="/mynote/assets/js/42.f3765b1f.js"><link rel="prefetch" href="/mynote/assets/js/43.64ebbc4e.js"><link rel="prefetch" href="/mynote/assets/js/44.c294ac1f.js"><link rel="prefetch" href="/mynote/assets/js/45.7645ed8d.js"><link rel="prefetch" href="/mynote/assets/js/46.3bdf45a9.js"><link rel="prefetch" href="/mynote/assets/js/47.60b5ba31.js"><link rel="prefetch" href="/mynote/assets/js/48.690c6b01.js"><link rel="prefetch" href="/mynote/assets/js/49.83b9f02a.js"><link rel="prefetch" href="/mynote/assets/js/5.c91ae51f.js"><link rel="prefetch" href="/mynote/assets/js/51.c7250caf.js"><link rel="prefetch" href="/mynote/assets/js/52.730c94e7.js"><link rel="prefetch" href="/mynote/assets/js/53.f1520df7.js"><link rel="prefetch" href="/mynote/assets/js/54.1334dc4e.js"><link rel="prefetch" href="/mynote/assets/js/55.54964a79.js"><link rel="prefetch" href="/mynote/assets/js/56.8ba62175.js"><link rel="prefetch" href="/mynote/assets/js/57.9c6a6d53.js"><link rel="prefetch" href="/mynote/assets/js/58.08f5216c.js"><link rel="prefetch" href="/mynote/assets/js/6.ef4e5f91.js"><link rel="prefetch" href="/mynote/assets/js/7.2a0220c0.js"><link rel="prefetch" href="/mynote/assets/js/8.bf20b497.js"><link rel="prefetch" href="/mynote/assets/js/9.2816d784.js">
    <link rel="stylesheet" href="/mynote/assets/css/0.styles.238f19cf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mynote/" class="home-link router-link-active"><img src="/mynote/logo.png" alt="Lost" class="logo"> <span class="site-name can-hide">Lost</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mynote/note/" class="nav-link router-link-active">note</a></div><div class="nav-item"><a href="/mynote/blog/" class="nav-link">blog</a></div><div class="nav-item"><a href="/mynote/resume/" class="nav-link">resume</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mynote/language/chinese/" class="nav-link">Chinese</a></li><li class="dropdown-item"><!----> <a href="/mynote/language/japanese/" class="nav-link">Japanese</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mynote/note/" class="nav-link router-link-active">note</a></div><div class="nav-item"><a href="/mynote/blog/" class="nav-link">blog</a></div><div class="nav-item"><a href="/mynote/resume/" class="nav-link">resume</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mynote/language/chinese/" class="nav-link">Chinese</a></li><li class="dropdown-item"><!----> <a href="/mynote/language/japanese/" class="nav-link">Japanese</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/mynote/note/JavaScript.html" class="sidebar-link">JavaScript</a></li><li><a href="/mynote/note/ES6.html" class="sidebar-link">ES6 语法</a></li><li><a href="/mynote/note/Node.html" class="sidebar-link">NodeAPI</a></li><li><a href="/mynote/note/React.html" class="sidebar-link">React</a></li><li><a href="/mynote/note/Vue.html" class="sidebar-link">Vue</a></li><li><a href="/mynote/note/TypeScript.html" class="sidebar-link">TyprScript</a></li><li><a href="/mynote/note/Babel.html" class="sidebar-link">Babel</a></li><li><a href="/mynote/note/CSS.html" class="sidebar-link">CSS</a></li><li><a href="/mynote/note/HTML5.html" class="sidebar-link">HTML5</a></li><li><a href="/mynote/note/Webpack.html" class="active sidebar-link">webpack@4.x</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mynote/note/Webpack.html#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/mynote/note/Webpack.html#安装与配置" class="sidebar-link">安装与配置</a></li><li class="sidebar-sub-header"><a href="/mynote/note/Webpack.html#命令行指令" class="sidebar-link">命令行指令</a></li><li class="sidebar-sub-header"><a href="/mynote/note/Webpack.html#本地静态服务" class="sidebar-link">本地静态服务</a></li><li class="sidebar-sub-header"><a href="/mynote/note/Webpack.html#编译功能" class="sidebar-link">编译功能</a></li><li class="sidebar-sub-header"><a href="/mynote/note/Webpack.html#路径别名" class="sidebar-link">路径别名</a></li><li class="sidebar-sub-header"><a href="/mynote/note/Webpack.html#异常处理记录" class="sidebar-link">异常处理记录</a></li><li class="sidebar-sub-header"><a href="/mynote/note/Webpack.html#eslint" class="sidebar-link">ESLint</a></li></ul></li><li><a href="/mynote/note/Git&amp;GitHub.html" class="sidebar-link">Git / GitHub 使用指南</a></li><li><a href="/mynote/note/npm&amp;yarn.html" class="sidebar-link">npm &amp; yarn</a></li><li><a href="/mynote/note/Electron.html" class="sidebar-link">Electron</a></li><li><a href="/mynote/note/ESLint.html" class="sidebar-link">Lint</a></li><li><a href="/mynote/note/MongoDB.html" class="sidebar-link">MongoDB</a></li><li><a href="/mynote/note/pm2.html" class="sidebar-link">pm2</a></li><li><a href="/mynote/note/Dart.html" class="sidebar-link">Dart</a></li><li><a href="/mynote/note/Flutter.html" class="sidebar-link">Flutter</a></li><li><a href="/mynote/note/Linux.html" class="sidebar-link">Linux</a></li><li><a href="/mynote/note/shell.html" class="sidebar-link">shell</a></li><li><a href="/mynote/note/Python.html" class="sidebar-link">Python</a></li><li><a href="/mynote/note/RegExp.html" class="sidebar-link">RegExp（JavaScript 对象）</a></li><li><a href="/mynote/note/Angular.html" class="sidebar-link">Angular</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack-4-x"><a href="#webpack-4-x" class="header-anchor">#</a> webpack@4.x</h1> <p>[TOC]</p> <h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <p>功能：用于项目的自动化构建，能够根据依赖关系，将静态资源打包压缩等</p> <p>当页面引入的静态资源多了以后：</p> <ul><li>会产生大量的二次请求；</li> <li>依赖关系错综复杂</li></ul> <p>webpack 自身只支持处理 JS，使用 loader 能够让 webpack 处理 JS 以外的文件
包括：出入口文件、模式、loader、plugin</p> <p>先简单地概述一下 webpack 的工作原理：webpack 读取入口文件（entry），然后递归查找所依赖的模块(module)，构建成一个“依赖图”，然后根据配置中的加载器(loader)和打包策略来对模块进行编译。</p> <p>但是如果中间有文件发生变化了，上面所述的整个递归遍历流程会重新再进行一次。</p> <h2 id="安装与配置"><a href="#安装与配置" class="header-anchor">#</a> 安装与配置</h2> <ul><li><code>npm i webpack webpack-cli -D</code> 命令进行安装</li> <li>默认配置文件为 <code>./webpack.config.js</code> 或 <code>./webpackfile.js</code></li> <li>webpack 默认只支持 JS 文件的打包，其他文件类型需要安装对应的 loader</li></ul> <h3 id="mode-字段"><a href="#mode-字段" class="header-anchor">#</a> mode 字段</h3> <h3 id="module-字段"><a href="#module-字段" class="header-anchor">#</a> module 字段</h3> <ul><li>rules：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> test<span class="token punctuation">:</span> <span class="token regex">/\.vue$/</span><span class="token punctuation">,</span> use<span class="token punctuation">:</span> <span class="token string">&quot;vue-loader&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span> use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> test<span class="token punctuation">:</span> <span class="token regex">/\.less$/</span><span class="token punctuation">,</span> use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;less-loader&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span> use<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    loader<span class="token punctuation">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// include: path.resolve(&quot;snake/src&quot;),</span>
    exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="devserver-字段"><a href="#devserver-字段" class="header-anchor">#</a> devServer 字段</h3> <div class="language-json extra-class"><pre class="language-json"><code>proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;/api&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    target<span class="token operator">:</span> <span class="token string">&quot;http://localhost:3000&quot;</span><span class="token punctuation">,</span>
    pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;/api&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">}</span> <span class="token comment">// 将/api替换掉</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token comment">// 访问：http://localhost:8080/api/test，就会被代理到：http://localhost:3000/test 上</span>
</code></pre></div><h3 id="plugins-字段"><a href="#plugins-字段" class="header-anchor">#</a> plugins 字段</h3> <ul><li>设置 HTML 模板：html-webpack-plugin 插件</li> <li>设置全局变量：webpack.ProvidePlugin 插件</li></ul> <h2 id="命令行指令"><a href="#命令行指令" class="header-anchor">#</a> 命令行指令</h2> <ul><li><code>npm i wabpack-cli -D</code> 安装打包依赖</li> <li><code>npx webpack</code> 命令进行打包，</li> <li>该命令会运行<code>./node_modules/webpack/bin/webpack.js</code> 文件</li> <li><code>npx webpack --config &lt;configFile&gt;</code> 手动指定配置文件</li> <li>默认情况下会将 <code>./src/</code> 目录下的文件打包到 <code>./dist/main.js</code>，入口文件 <code>index.js</code></li></ul> <h2 id="本地静态服务"><a href="#本地静态服务" class="header-anchor">#</a> 本地静态服务</h2> <ul><li><code>npm i webpack-dev-server -D</code> 安装开发服务依赖</li> <li><code>npx webpack-dev-server</code> 命令启动静态服务
打包文件的存放目录为项目根目录，保存在内存中而不是硬盘中</li></ul> <h2 id="编译功能"><a href="#编译功能" class="header-anchor">#</a> 编译功能</h2> <h3 id="编译-html-文件"><a href="#编译-html-文件" class="header-anchor">#</a> 编译 HTML 文件</h3> <ul><li><code>npm i html-webpack-plugin -D</code> 安装 HTML 插件</li> <li>在 <code>./webpack.config.js</code> 中进行配置</li> <li>在打包 JS 文件时也会打包 HTML 文件，并自动引入打包后的 JS 文件</li></ul> <h3 id="编译-css-文件"><a href="#编译-css-文件" class="header-anchor">#</a> 编译 CSS 文件</h3> <ul><li><code>npm i css-loader style-loader less-loader -D</code> 安装 CSS 插件</li> <li>在 <code>./webpack.config.js</code> 中进行配置</li> <li>在 JS 源文件中引入 CSS 文件</li></ul> <h3 id="抽离-css-样式"><a href="#抽离-css-样式" class="header-anchor">#</a> 抽离 CSS 样式</h3> <ul><li><code>npm i mini-css-extract-plugin -D</code> 安装插件</li> <li>在 <code>./webpack.config.js</code> 中进行配置</li> <li><code>css-loader?modules</code> 为样式表启用模块化（css-in-js）</li> <li><code>css-loader?localIdentName=[name]-[local]</code> <ul><li><code>[name]</code> 样式表名称</li> <li><code>[path]</code> 样式表相对于项目根目录的路径</li> <li><code>[local]</code> 样式表类名名称</li> <li><code>[hash:&lt;length&gt;]</code> 样式表哈希值</li></ul></li> <li>在打包时会将 CSS 样式抽离到一个文件中，并在 HTML 中引用</li></ul> <h3 id="压缩-css-文件"><a href="#压缩-css-文件" class="header-anchor">#</a> 压缩 CSS 文件</h3> <ul><li><code>npm i optimize-css-assets-webpack-plugin -D</code> 安装 CSS 压缩插件
<code>npm i uglifyjs-webpack-plugin -D</code> 安装 JS 压缩插件</li> <li>在 <code>./webpack.config.js</code> 中进行配置（需要使用生产模式）</li></ul> <h3 id="添加浏览器前缀"><a href="#添加浏览器前缀" class="header-anchor">#</a> 添加浏览器前缀</h3> <ul><li><code>npm i postcss-loader autoprefixer -D</code> 安装插件</li> <li>在 <code>./webpack.config.js</code>、<code>./postcss.config.js</code> 中进行配置</li></ul> <h3 id="编译-less-sass-stylus"><a href="#编译-less-sass-stylus" class="header-anchor">#</a> 编译 less/sass/stylus</h3> <ul><li><p><code>npm i less less-loader -D</code> 安装 less 插件
<code>npm i node-sass sass-loader -D</code> 安装 sass 插件
<code>npm i stylus stylus-loader -D</code> 安装 stylus 插件</p></li> <li><p>在 <code>./webpack.config.js</code> 中进行配置</p></li> <li><p>在 JS 源文件中引入 less/sass/stylus 文件</p></li></ul> <h3 id="处理静态资源"><a href="#处理静态资源" class="header-anchor">#</a> 处理静态资源</h3> <ul><li><code>npm i url-loader file-loader -D</code></li> <li>url-loader 用于将图片转换为 base64，file-loader 用于打包静态资源，生成 public URL</li> <li>在 <code>./webpack.config.js</code> 中进行配置</li> <li><code>{ test: /\.png$/, use: &quot;url-loader&quot; }</code></li> <li>定义多大的图片转换为 base64</li> <li><code>use: [option: { limit:50000, outputPath: 'images' }]</code></li></ul> <h3 id="转换高级语法"><a href="#转换高级语法" class="header-anchor">#</a> 转换高级语法</h3> <ul><li><code>npm i babel-loader -D</code> 安装 loader
<code>npm i @babel/core @babel/cli -D</code> 安装 babel 核心模块
<code>@babel/preset-env</code> 可以根据配置的目标运行环境，自动将 ES2015+ 的代码转换为 ES5。
<code>@babel/polyfill</code> 用于加载 <em>polyfill</em> 库，解决了 Babel 不转换新 API 的问题
<code>@babel/runtime</code> 提供编译模块的工具函数，启用插件 babel-plugin-transform-runtime 后，Babel 就会使用 babel-runtime 下的工具函数</li> <li>在 <code>./webpack.config.js</code> 中进行配置</li> <li><code>module: { rules: [{ exclude: /node_modules/ }] }</code> 编译时忽略 node_modules 文件夹</li></ul> <h3 id="代码校验"><a href="#代码校验" class="header-anchor">#</a> 代码校验</h3> <ul><li><code>npm i eslint eslint-loader -D</code> 安装 babel 核心模块</li> <li>下载 <code>.eslintrc.json</code> 规则文件</li> <li>在 <code>./webpack.config.js</code> 中进行配置</li></ul> <h2 id="路径别名"><a href="#路径别名" class="header-anchor">#</a> 路径别名</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code>resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>
	extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.jsx&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 在引入文件时这几种后缀名可以省略</span>
  alias<span class="token punctuation">:</span> <span class="token punctuation">{</span>
		<span class="token string">&quot;@&quot;</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./src&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="异常处理记录"><a href="#异常处理记录" class="header-anchor">#</a> 异常处理记录</h2> <h3 id="cannot-find-module-webpack-lib-node-nodetemplateplugin"><a href="#cannot-find-module-webpack-lib-node-nodetemplateplugin" class="header-anchor">#</a> Cannot find module 'webpack/lib/node/NodeTemplatePlugin'</h3> <ul><li>npm remove webpack -g</li> <li>npm i webpack --save-dev（不要全局安装）</li> <li>有建议将上一句分为如下两句操作（获得多数人认可）：</li> <li>npm i webpack -g</li> <li>npm link webpack --save-dev</li></ul> <h3 id="引入-node-模块报错"><a href="#引入-node-模块报错" class="header-anchor">#</a> 引入 Node 模块报错</h3> <ul><li>在配置文件中添加：<code>node: { &lt;moduleName&gt;: &quot;empty&quot; }</code></li></ul> <h2 id="eslint"><a href="#eslint" class="header-anchor">#</a> ESLint</h2> <p>&lt;cintent&gt;</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mynote/note/HTML5.html" class="prev">HTML5</a></span> <span class="next"><a href="/mynote/note/Git&amp;GitHub.html">Git / GitHub 使用指南</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/mynote/assets/js/app.2c9fd942.js" defer></script><script src="/mynote/assets/js/2.6669d9a5.js" defer></script><script src="/mynote/assets/js/50.b864681f.js" defer></script>
  </body>
</html>
